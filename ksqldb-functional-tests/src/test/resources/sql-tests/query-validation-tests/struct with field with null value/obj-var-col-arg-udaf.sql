--@test: obj-var-col-arg-udaf - only primitives in var arg
CREATE STREAM INPUT (ID BIGINT KEY, FIRST integer, SECOND bigint, THIRD boolean, FOURTH double, FIFTH integer, SIXTH string) WITH (kafka_topic='input_topic', value_format='JSON');
CREATE TABLE OUTPUT as SELECT id, OBJ_COL_ARG(FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) as RESULT FROM INPUT group by id;
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 6, 5, true, 3.2, 7, 'hello');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 2, 1, false, 1.44, 8, 'world');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, NULL, 5, true, 12.34, 1, 'test');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 5, 3, NULL, 0.9, 2, 'udaf');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 5, NULL, true, 1.2, 6, 'aggregate');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 3, 7, false, NULL, 8, 'function');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 2, 2, true, 9.8, NULL, 'ksql');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 21, 10, NULL, 5.0, 2, 'qtt');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, NULL, 20, true, NULL, 3, 'variadic');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 3, 2, false, 4.3, 4, 'object');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 6, 1, false, 4.9, 10, NULL);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2, 3]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2, 3]);

--@test: obj-var-col-arg-udaf - different decimals in var arg
CREATE STREAM INPUT (ID BIGINT KEY, FIRST integer, SECOND bigint, THIRD boolean, FOURTH decimal(5, 1), FIFTH integer, SIXTH decimal(4, 3)) WITH (kafka_topic='input_topic', value_format='JSON');
CREATE TABLE OUTPUT as SELECT id, OBJ_COL_ARG(FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) as RESULT FROM INPUT group by id;
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 6, 5, true, 3.2, 7, 1.23);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 2, 1, false, 1.4, 8, 1.567);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, NULL, 5, true, 12.3, 1, 8.76);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 5, 3, NULL, 0.9, 2, 5.34);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 5, NULL, true, 1.2, 6, 0.912);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 3, 7, false, NULL, 8, 5.823);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 2, 2, true, 9.8, NULL, 3.42);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 21, 10, NULL, 5.0, 2, 7.31);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, NULL, 20, true, NULL, 3, 0.418);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 3, 2, false, 4.3, 4, 9.352);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 6, 1, false, 4.9, 10, NULL);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2, 3]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2, 3]);

--@test: obj-var-col-arg-udaf - struct in var arg
CREATE STREAM INPUT (ID BIGINT KEY, FIRST integer, SECOND bigint, THIRD boolean, FOURTH double, FIFTH integer, SIXTH struct<a int, b varchar>) WITH (kafka_topic='input_topic', value_format='JSON');
CREATE TABLE OUTPUT as SELECT id, OBJ_COL_ARG(FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) as RESULT FROM INPUT group by id;
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 6, 5, true, 3.2, 7, STRUCT(a:=3, b:='hello'));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 2, 1, false, 1.44, 8, STRUCT(a:=8, b:='world'));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, NULL, 5, true, 12.34, 1, STRUCT(a:=7, b:='test'));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 5, 3, NULL, 0.9, 2, STRUCT(a:=1, b:=NULL));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 5, NULL, true, 1.2, 6, STRUCT(a:=5, b:='aggregate'));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 3, 7, false, NULL, 8, STRUCT(a:=10, b:='function'));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 2, 2, true, 9.8, NULL, STRUCT(a:=8, b:='ksql'));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 21, 10, NULL, 5.0, 2, STRUCT(a:=NULL, b:='qtt'));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, NULL, 20, true, NULL, 3, STRUCT(a:=2, b:='variadic'));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 3, 2, false, 4.3, 4, STRUCT(a:=0, b:='object'));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 6, 1, false, 4.9, 10, NULL);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2, 3]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2, 3]);

--@test: obj-var-col-arg-udaf - map in var arg
CREATE STREAM INPUT (ID BIGINT KEY, FIRST integer, SECOND bigint, THIRD boolean, FOURTH double, FIFTH integer, SIXTH map<varchar, int>) WITH (kafka_topic='input_topic', value_format='JSON');
CREATE TABLE OUTPUT as SELECT id, OBJ_COL_ARG(FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) as RESULT FROM INPUT group by id;
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 6, 5, true, 3.2, 7, MAP('hello':=3));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 2, 1, false, 1.44, 8, MAP('world':=8));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, NULL, 5, true, 12.34, 1, MAP('test':=7));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 5, 3, NULL, 0.9, 2, MAP('udaf':=1));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 5, NULL, true, 1.2, 6, MAP('aggregate':=5));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 3, 7, false, NULL, 8, MAP('function':=10));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 2, 2, true, 9.8, NULL, MAP('ksql':=8));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 21, 10, NULL, 5.0, 2, MAP('qtt':=11));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, NULL, 20, true, NULL, 3, MAP('variadic':=2));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 3, 2, false, 4.3, 4, MAP('object':=0));
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 6, 1, false, 4.9, 10, NULL);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2, 3]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2, 3]);

--@test: obj-var-col-arg-udaf - list in var arg
CREATE STREAM INPUT (ID BIGINT KEY, FIRST integer, SECOND bigint, THIRD boolean, FOURTH double, FIFTH integer, SIXTH array<int>) WITH (kafka_topic='input_topic', value_format='JSON');
CREATE TABLE OUTPUT as SELECT id, OBJ_COL_ARG(FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) as RESULT FROM INPUT group by id;
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 6, 5, true, 3.2, 7, ARRAY[3, 5]);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 2, 1, false, 1.44, 8, ARRAY[8, 1]);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, NULL, 5, true, 12.34, 1, ARRAY[7, 0, 2]);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 5, 3, NULL, 0.9, 2, ARRAY[1]);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 5, NULL, true, 1.2, 6, ARRAY[5, 13]);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 3, 7, false, NULL, 8, ARRAY[10, NULL]);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 2, 2, true, 9.8, NULL, ARRAY[8, 1, 19]);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 21, 10, NULL, 5.0, 2, ARRAY[11, 20]);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, NULL, 20, true, NULL, 3, ARRAY[2]);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 3, 2, false, 4.3, 4, ARRAY[0, 0]);
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 6, 1, false, 4.9, 10, NULL);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2, 3]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2, 3]);

--@test: obj-var-col-arg-udaf - no variadic args
CREATE STREAM INPUT (ID BIGINT KEY, FIRST integer, SECOND bigint, THIRD boolean, FOURTH double, FIFTH integer, SIXTH string) WITH (kafka_topic='input_topic', value_format='JSON');
CREATE TABLE OUTPUT as SELECT id, OBJ_COL_ARG(FIRST) as RESULT FROM INPUT group by id;
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 6, 5, true, 3.2, 7, 'hello');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 2, 1, false, 1.44, 8, 'world');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, NULL, 5, true, 12.34, 1, 'test');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 5, 3, NULL, 0.9, 2, 'udaf');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 5, NULL, true, 1.2, 6, 'aggregate');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 3, 7, false, NULL, 8, 'function');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 2, 2, true, 9.8, NULL, 'ksql');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (0, 21, 10, NULL, 5.0, 2, 'qtt');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, NULL, 20, true, NULL, 3, 'variadic');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 3, 2, false, 4.3, 4, 'object');
INSERT INTO `INPUT` (ID, FIRST, SECOND, THIRD, FOURTH, FIFTH, SIXTH) VALUES (100, 6, 1, false, 4.9, 10, NULL);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2, 5]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6, 5]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2, 5, 3]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2, 5, 3, 2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (0, ARRAY[6, 5, 21]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2, 5, 3, 2]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2, 5, 3, 2, 3]);
ASSERT VALUES `OUTPUT` (ID, RESULT) VALUES (100, ARRAY[2, 5, 3, 2, 3, 6]);

